<%# Reviews section component %>
<%# Usage: render "reviews/reviews_section", reviewable: @location %>

<%
  per_page = 5
  initial_reviews = reviewable.reviews.recent.limit(per_page)
  total_reviews = reviewable.reviews_count
  has_more = total_reviews > per_page
  reviews_path = polymorphic_path([reviewable, :reviews])
%>

<div id="reviews-section" class="space-y-6">
  <%# Reviews Header %>
  <div class="flex items-center justify-between">
    <h3 class="text-xl font-bold text-gray-900 dark:text-white">
      <%= t("reviews.title", default: "Recenzije") %>
      <span class="text-gray-500 dark:text-gray-400 font-normal text-base ml-2">(<%= total_reviews %>)</span>
    </h3>
    <% if reviewable.has_reviews? %>
      <div class="flex items-center space-x-2">
        <%= render "shared/star_rating", rating: reviewable.average_rating %>
        <span class="font-semibold text-gray-900 dark:text-white"><%= number_with_precision(reviewable.average_rating, precision: 1) %></span>
      </div>
    <% end %>
  </div>

  <%# Reviews List %>
  <% if initial_reviews.any? %>
    <div id="reviews-list" class="space-y-4">
      <% initial_reviews.each do |review| %>
        <%= render "reviews/review_card", review: review %>
      <% end %>
    </div>

    <%# Load More Button %>
    <% if has_more %>
      <div id="reviews-pagination" class="text-center">
        <%= link_to "#{reviews_path}?page=2",
                    class: "inline-flex items-center px-6 py-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-xl transition-colors",
                    data: { turbo_stream: true } do %>
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
          <%= t("reviews.load_more", default: "Učitaj još recenzija") %>
          <span class="ml-2 text-gray-500 dark:text-gray-400">(<%= total_reviews - per_page %> <%= t("reviews.remaining", default: "preostalo") %>)</span>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <div class="text-center py-8 bg-gray-50 dark:bg-gray-700 rounded-xl">
      <svg class="w-12 h-12 mx-auto text-gray-400 dark:text-gray-500 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      <p class="text-gray-600 dark:text-gray-400"><%= t("reviews.none", default: "Jos nema recenzija. Budi prvi!") %></p>
    </div>
  <% end %>

  <%# Review Form %>
  <div class="mt-8">
    <%= render "reviews/form", reviewable: reviewable, review: Review.new %>
  </div>
</div>
