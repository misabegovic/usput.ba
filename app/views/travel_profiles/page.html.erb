<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
  <%# Navigation %>
  <%= render "new_design/header" %>

  <div data-controller="travel-profile"
       data-travel-profile-logged-in-value="<%= logged_in? %>"
       data-travel-profile-username-value="<%= current_user&.username %>"
       data-travel-profile-translations-value="<%= travel_profile_translations_json %>"
       class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-8">

    <%# Header %>
    <div class="bg-gradient-to-r from-blue-600 to-blue-500 rounded-2xl p-6 sm:p-8 text-white mb-8">
      <div class="flex items-center justify-between">
        <div>
          <% if logged_in? %>
            <h1 class="text-2xl sm:text-3xl font-bold"><%= current_user.username %></h1>
            <p class="text-white/80 mt-1"><%= t('profile.logged_in_subtitle', default: 'Profil je trajno sa캜uvan') %></p>
          <% else %>
            <h1 class="text-2xl sm:text-3xl font-bold"><%= t('profile.title', default: 'Moj Travel Profil') %></h1>
            <p class="text-white/80 mt-1"><%= t('profile.subtitle', default: 'Tvoja putovanja na jednom mjestu') %></p>
          <% end %>
        </div>
        <%# Avatar section %>
        <div class="relative group" data-controller="avatar-upload">
          <% if logged_in? && current_user.avatar.attached? %>
            <%= safe_attachment_image_tag current_user.avatar, variant_options: :medium, class: "w-16 h-16 sm:w-20 sm:h-20 rounded-full object-cover border-2 border-white/30", alt: current_user.username %>
          <% else %>
            <div class="w-16 h-16 sm:w-20 sm:h-20 bg-white/20 rounded-full flex items-center justify-center">
              <svg class="w-8 h-8 sm:w-10 sm:h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
          <% end %>
          <% if logged_in? %>
            <%# Upload overlay %>
            <label class="absolute inset-0 flex items-center justify-center bg-black/50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <%= form_with url: update_avatar_path, method: :patch, multipart: true, data: { avatar_upload_target: "form", turbo: false } do |f| %>
                <%= f.file_field :avatar, accept: "image/jpeg,image/png,image/webp,image/gif", class: "hidden", data: { avatar_upload_target: "input", action: "change->avatar-upload#submit" } %>
              <% end %>
            </label>
            <% if current_user.avatar.attached? %>
              <%= button_to remove_avatar_path, method: :delete, class: "absolute -bottom-1 -right-1 w-6 h-6 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center text-white opacity-0 group-hover:opacity-100 transition-opacity", title: t('profile.avatar.remove', default: 'Ukloni sliku'), data: { turbo_confirm: t('profile.avatar.remove_confirm', default: 'Da li ste sigurni da 쬰lite ukloniti profilnu sliku?') } do %>
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>

      <%# Stats %>
      <div class="grid grid-cols-3 gap-4 mt-6 pt-6 border-t border-white/20">
        <div class="text-center">
          <p data-travel-profile-target="visitedCount" class="text-3xl font-bold">0</p>
          <p class="text-sm text-white/80"><%= t('profile.visited', default: 'Posje캖eno') %></p>
        </div>
        <div class="text-center">
          <p data-travel-profile-target="favoritesCount" class="text-3xl font-bold">0</p>
          <p class="text-sm text-white/80"><%= t('profile.favorites', default: 'Omiljeno') %></p>
        </div>
        <div class="text-center">
          <p data-travel-profile-target="badgesCount" class="text-3xl font-bold">0</p>
          <p class="text-sm text-white/80"><%= t('profile.badges', default: 'Badges') %></p>
        </div>
      </div>
    </div>

    <% unless logged_in? %>
      <%# Login/Register prompt for guests %>
      <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-2xl p-6 mb-8">
        <div class="flex items-start">
          <svg class="w-6 h-6 text-amber-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
          </svg>
          <div class="ml-4">
            <h3 class="font-semibold text-amber-800 dark:text-amber-200"><%= t('profile.save_title', default: 'Sa캜uvaj svoj profil') %></h3>
            <p class="text-sm text-amber-700 dark:text-amber-300 mt-1">
              <%= t('profile.save_warning', default: 'Tvoj profil je sa캜uvan samo u ovom pregledniku.') %>
              <%= t('profile.save_warning_extended', default: 'Registruj se da bi trajno sa캜uvao svoje podatke.') %>
            </p>
            <div class="mt-4 flex flex-wrap gap-3">
              <a href="<%= register_path %>" class="inline-flex items-center px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-medium rounded-lg transition-colors">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                </svg>
                <%= t('auth.register_button', default: 'Registruj se') %>
              </a>
              <a href="<%= login_path %>" class="inline-flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-lg transition-colors">
                <%= t('auth.login_button', default: 'Prijavi se') %>
              </a>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <div class="grid gap-6 md:grid-cols-2">
      <%# Visited Locations %>
      <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 sm:p-6 shadow-lg min-w-0">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
          <span class="w-10 h-10 bg-emerald-100 dark:bg-emerald-900/30 rounded-xl flex items-center justify-center mr-3 flex-shrink-0">
            <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
          </span>
          <%= t('profile.visited_places', default: 'Posje캖ena Mjesta') %>
        </h2>
        <div data-travel-profile-target="visitedList" class="space-y-3">
          <p class="text-gray-500 dark:text-gray-400 text-sm py-4 text-center">
            <%= t('profile.no_visited', default: 'Jo코 nisi posjetio nijednu lokaciju') %>
          </p>
        </div>
        <button data-travel-profile-target="visitedShowMore"
                data-action="click->travel-profile#showMoreVisited"
                class="hidden w-full mt-4 py-2 text-sm text-emerald-600 dark:text-emerald-400 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 rounded-lg transition-colors font-medium">
          <span><%= t('profile.show_more', default: 'Prika쬴 jo코') %></span>
        </button>
      </div>

      <%# Favorites %>
      <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 sm:p-6 shadow-lg min-w-0">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
          <span class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-xl flex items-center justify-center mr-3 flex-shrink-0">
            <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
            </svg>
          </span>
          <%= t('profile.favorites', default: 'Omiljeno') %>
        </h2>
        <div data-travel-profile-target="favoritesList" class="space-y-3">
          <p class="text-gray-500 dark:text-gray-400 text-sm py-4 text-center">
            <%= t('profile.no_favorites', default: 'Jo코 nema코 omiljenih lokacija') %>
          </p>
        </div>
        <button data-travel-profile-target="favoritesShowMore"
                data-action="click->travel-profile#showMoreFavorites"
                class="hidden w-full mt-4 py-2 text-sm text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors font-medium">
          <span><%= t('profile.show_more', default: 'Prika쬴 jo코') %></span>
        </button>
      </div>

      <%# Badges %>
      <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 sm:p-6 shadow-lg min-w-0">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
          <span class="w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-xl flex items-center justify-center mr-3 text-xl flex-shrink-0">
            <span>游끥</span>
          </span>
          <%= t('profile.my_badges', default: 'Moji Badges') %>
        </h2>
        <div data-travel-profile-target="badgesList" class="space-y-3">
          <p class="text-gray-500 dark:text-gray-400 text-sm py-4 text-center">
            <%= t('profile.no_badges', default: 'Jo코 nema코 nijedan badge') %>
          </p>
        </div>
        <button data-travel-profile-target="badgesShowMore"
                data-action="click->travel-profile#showMoreBadges"
                class="hidden w-full mt-4 py-2 text-sm text-amber-600 dark:text-amber-400 hover:bg-amber-50 dark:hover:bg-amber-900/20 rounded-lg transition-colors font-medium">
          <span><%= t('profile.show_more', default: 'Prika쬴 jo코') %></span>
        </button>
      </div>

      <%# Recently Viewed %>
      <div class="bg-white dark:bg-gray-800 rounded-2xl p-4 sm:p-6 shadow-lg min-w-0">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center">
          <span class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center mr-3 flex-shrink-0">
            <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
            </svg>
          </span>
          <%= t('profile.recently_viewed', default: 'Nedavno Pregledano') %>
        </h2>
        <div data-travel-profile-target="recentlyViewed" class="space-y-3">
          <p class="text-gray-500 dark:text-gray-400 text-sm py-4 text-center">
            <%= t('profile.no_recent', default: 'Nema nedavno pregledanih') %>
          </p>
        </div>
        <button data-travel-profile-target="recentShowMore"
                data-action="click->travel-profile#showMoreRecent"
                class="hidden w-full mt-4 py-2 text-sm text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors font-medium">
          <span><%= t('profile.show_more', default: 'Prika쬴 jo코') %></span>
        </button>
      </div>
    </div>

    <%# My Plans Section - For all users %>
    <%= render "travel_profiles/my_plans" %>

    <%# Actions %>
    <div class="mt-8 bg-white dark:bg-gray-800 rounded-2xl p-4 sm:p-6 shadow-lg">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4"><%= t('profile.actions', default: 'Akcije') %></h2>
      <div class="grid gap-3 sm:gap-4 sm:grid-cols-2 lg:grid-cols-3">
        <button data-action="click->travel-profile#exportProfile"
                class="flex items-center justify-center px-4 py-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-xl text-gray-700 dark:text-gray-300 font-medium transition-colors">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
          </svg>
          <%= t('profile.export_json', default: 'Export (JSON)') %>
        </button>

        <button data-action="click->travel-profile#exportProfilePdf"
                class="flex items-center justify-center px-4 py-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-xl text-gray-700 dark:text-gray-300 font-medium transition-colors">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
          </svg>
          <%= t('profile.export_pdf', default: 'Print / PDF') %>
        </button>

        <label class="flex items-center justify-center px-4 py-3 bg-emerald-100 dark:bg-emerald-900/30 hover:bg-emerald-200 dark:hover:bg-emerald-900/50 rounded-xl text-emerald-700 dark:text-emerald-400 font-medium transition-colors cursor-pointer">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
          </svg>
          <%= t('profile.import', default: 'Import Profila') %>
          <input type="file" accept=".json" data-action="change->travel-profile#importProfile" class="hidden">
        </label>

        <% if logged_in? %>
          <%= button_to logout_path, method: :delete, class: "flex items-center justify-center px-4 py-3 bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 rounded-xl text-red-700 dark:text-red-400 font-medium transition-colors" do %>
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            <%= t('auth.logout', default: 'Odjavi se') %>
          <% end %>
        <% end %>
      </div>
    </div>

    <%# Curator Section %>
    <% if logged_in? && current_user.curator? %>
      <%# Curator Dashboard Link %>
      <div class="mt-8 bg-gradient-to-br from-purple-100 to-indigo-100 dark:from-purple-900/30 dark:to-indigo-900/30 border border-purple-300 dark:border-purple-700 rounded-2xl p-4 sm:p-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
          <div class="flex items-center">
            <div class="w-12 h-12 bg-purple-200 dark:bg-purple-800 rounded-xl flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-purple-700 dark:text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
              </svg>
            </div>
            <div class="ml-4">
              <h3 class="text-lg font-semibold text-purple-900 dark:text-purple-100">
                <%= t('profile.curator.you_are_curator', default: 'Ti si Curator') %>
              </h3>
              <p class="text-sm text-purple-700 dark:text-purple-300">
                <%= t('profile.curator.manage_content', default: 'Upravljaj lokacijama i iskustvima') %>
              </p>
            </div>
          </div>
          <a href="<%= curator_root_path %>" class="inline-flex items-center px-5 py-2.5 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors shadow-md">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
            </svg>
            <%= t('profile.curator.open_dashboard', default: 'Otvori Dashboard') %>
          </a>
        </div>
      </div>
    <% else %>
      <%# Become a Curator Section %>
      <div class="mt-8 bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-900/20 dark:to-indigo-900/20 border border-purple-200 dark:border-purple-800 rounded-2xl p-4 sm:p-6">
        <div class="flex items-start">
          <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/50 rounded-xl flex items-center justify-center flex-shrink-0">
            <svg class="w-6 h-6 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
            </svg>
          </div>
          <div class="ml-4 flex-1">
            <h3 class="text-lg font-semibold text-purple-900 dark:text-purple-100">
              <%= t('profile.curator.title', default: 'Postani Curator') %>
            </h3>
            <p class="text-sm text-purple-700 dark:text-purple-300 mt-1">
              <%= t('profile.curator.description', default: 'Curatori mogu dodavati nove lokacije, iskustva i sadr쬬j na platformu. Pomozi nam da otkrijemo skrivene dragulje Bosne i Hercegovine!') %>
            </p>
            <div class="mt-4">
              <%= link_to become_curator_path, class: "inline-flex items-center px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors" do %>
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                </svg>
                <%= t('profile.curator.apply', default: 'Prijavi se za Curatora') %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>

  <%# Footer %>
  <%= render "new_design/footer" %>
</div>
