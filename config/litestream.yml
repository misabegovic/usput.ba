# Litestream configuration for SQLite replication
# Documentation: https://litestream.io/reference/config/
#
# Required environment variables:
#   LITESTREAM_REPLICA_URL - S3-compatible bucket URL (e.g., s3://bucket-name/db)
#
# Optional environment variables:
#   LITESTREAM_ACCESS_KEY_ID     - AWS/S3 access key
#   LITESTREAM_SECRET_ACCESS_KEY - AWS/S3 secret key
#   LITESTREAM_REGION            - AWS region (default: us-east-1)
#   LITESTREAM_ENDPOINT          - Custom S3 endpoint for MinIO, Backblaze, etc.

# S3-compatible storage credentials (uses env vars automatically via LITESTREAM_* prefix)
access-key-id: ${LITESTREAM_ACCESS_KEY_ID}
secret-access-key: ${LITESTREAM_SECRET_ACCESS_KEY}

dbs:
  # Primary production database - this is the main database that needs replication
  - path: /rails/storage/production.sqlite3
    replicas:
      - type: s3
        url: ${LITESTREAM_REPLICA_URL}
        # Sync interval - how often to sync WAL changes (default: 1s)
        sync-interval: 1s
        # Snapshot interval - full database snapshots (default: 24h)
        snapshot-interval: 24h
        # Retention period for snapshots (30 days)
        retention: 720h
        # How often to check for expired snapshots
        retention-check-interval: 1h
